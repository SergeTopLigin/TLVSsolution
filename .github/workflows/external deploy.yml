name: external deploy

on:
  workflow_dispatch:
  # schedule:
  #   - cron: '*/5 * * * *'
    
jobs:
  build:
    runs-on: ubuntu-latest
    
    steps:
      - name: Set up Python 3.10  # установка версии окружения
        uses: actions/setup-python@0a5c61591373683505ea898e09a3ea4f39ef2b9c
        with:
          python-version: "3.10"
      - name: repo checkout  # загрузка содержимого репозитория на вирт машину
        uses: actions/checkout@b4ffde65f46336ab88eb53be808477a3936bae11  
        with:
          sparse-checkout: TL_VS_project   # загрузка только папки проекта
      - name: list current folder  # проверка загрузки
        run: ls
      - name: Install Dependencies  # Установить зависимости
        run: pip install -r TL_VS_project/requirements_static.txt
      - name: Run script    # запуск frozen-flask, создание /build
        run: python TL_VS_project/freeze.py
      - name: list build folder  # проверка адреса /build
        run: ls ./TL_VS_project/TL_flask
      - name: Deploy  # deploy происходит из внешнего репо pages из ветки gh-pages (указанной в settings), 
                      # в которую размещается папка build, созданная посредством .py на runner, запущенном из этого репо
        uses: peaceiris/actions-gh-pages@373f7f263a76c20808c831209c920827a82a2847
        with:
          deploy_key: ${{ secrets.ACTIONS_DEPLOY_KEY }}
          # When you use deploy_key, set your private key to the repository which includes this action and set your public key to your external repository.
          external_repository: Top-Liga/Top-Liga.github.io
          publish_branch: gh-pages
          publish_dir: ./TL_VS_project/TL_flask/build
